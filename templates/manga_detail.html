{% extends "base.html" %}

{% block title %}{{ manga.title }} – Manga Index{% endblock %}

{% block content %}
  <article class="manga-detail">
    <div class="manga-detail-header">
      {% if manga.cover_image_url %}
        <div class="manga-cover-lg">
          <img src="{{ manga.cover_image_url }}" alt="{{ manga.title }} cover">
        </div>
      {% else %}
        <div class="manga-cover-lg placeholder">
          <span>{{ manga.title[0] }}</span>
        </div>
      {% endif %}

      <div class="manga-detail-info">
        <h1>{{ manga.title }}</h1>
        {% if manga.alt_title %}
          <p class="alt-title">{{ manga.alt_title }}</p>
        {% endif %}
        <p class="meta">
          Status: {{ manga.status|capitalize }}<br>
          Type: {{ manga.type|capitalize }}<br>
          Rating: {{ manga.content_rating|capitalize }}
        </p>
        {% if manga.description %}
          <p class="description">{{ manga.description }}</p>
        {% endif %}

        {% if user %}
          <section class="add-to-list">
            <h3>Add to List</h3>
            {% if user_lists %}
              <form action="/lists/add" method="post" class="inline-form">
                <input type="hidden" name="manga_id" value="{{ manga.id }}">
                <select name="list_id" required>
                  {% for l in user_lists %}
                    <option value="{{ l.id }}">{{ l.name }}</option>
                  {% endfor %}
                </select>
                <button type="submit" class="btn primary">Add</button>
              </form>
              <p class="small-note">
                or <a href="/lists/new">create a new list</a>.
              </p>
            {% else %}
              <p>You have no lists yet. <a href="/lists/new">Create your first list</a>.</p>
            {% endif %}
          </section>
        {% else %}
          <p><a href="/auth/login">Log in</a> to save this manga to your own lists.</p>
        {% endif %}
      </div>
    </div>

    <section class="chapter-list">
      <h2>Chapters</h2>
      {% if chapters %}
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Language</th>
              <th>Source</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for ch in chapters %}
              <tr>
                <td>{{ ch.number }}</td>
                <td>{{ ch.title or 'Chapter ' ~ ch.number }}</td>
                <td>{{ ch.language|upper }}</td>
                <td>{{ ch.source_name or 'Unknown' }}</td>
                <td>
                  <a
                    href="/api/chapters/{{ ch.id }}/read"
                    target="_blank"
                    rel="noopener"
                  >
                    Read →
                  </a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No chapters found.</p>
      {% endif %}
    </section>
  </article>
{% endblock %}
